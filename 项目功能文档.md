# 智能家居商城项目功能文档

## 项目概述

这是一个基于 Next.js 15 开发的智能家居电商平台，包含完整的前端用户界面和后端API系统。项目采用现代化的技术栈，提供用户购物、管理员后台、支付系统、优惠券系统、抽奖活动等完整的电商功能。

## 技术栈

- **前端框架**: Next.js 15 (React 19)
- **样式框架**: Tailwind CSS 4
- **数据库**: PostgreSQL + Prisma ORM
- **认证系统**: NextAuth.js
- **UI组件**: Headless UI + Heroicons
- **类型检查**: TypeScript
- **代码规范**: ESLint

## 数据库设计

### 核心数据模型

1. **用户系统**
   - `User`: 用户基本信息，支持角色权限（USER/ADMIN/SUPER_ADMIN）
   - `Address`: 用户收货地址管理

2. **商品系统**
   - `Category`: 商品分类（支持层级结构）
   - `Product`: 商品信息（价格、库存、规格等）
   - `CartItem`: 购物车商品

3. **订单系统**
   - `Order`: 订单主表
   - `OrderItem`: 订单商品明细
   - 订单状态：待付款→已付款→已发货→已送达→已取消/已退款

4. **营销系统**
   - `Coupon`: 优惠券（折扣券、满减券、免邮券、免单券）
   - `UserCoupon`: 用户优惠券关联
   - `OrderCoupon`: 订单优惠券使用记录

5. **抽奖系统**
   - `LotteryActivity`: 抽奖活动
   - `LotteryPrize`: 抽奖奖品
   - `LotteryLog`: 抽奖记录

6. **系统配置**
   - `SystemConfig`: 系统配置项

## 已实现功能

### 1. 用户端功能

#### 1.1 商品浏览
- **商品列表页** (`/products`)
  - 商品搜索功能（按名称、描述、品牌搜索）
  - 分类筛选
  - 价格排序
  - 分页显示
  - 响应式设计

- **商品详情页** (`/products/[id]`)
  - 商品详细信息展示
  - 商品图片轮播
  - 规格选择
  - 数量选择
  - 添加到购物车
  - 立即购买

#### 1.2 购物车系统
- **购物车页面** (`/cart`)
  - 商品列表展示
  - 数量修改
  - 商品删除
  - 全选/取消全选
  - 价格计算（原价、现价、优惠金额）
  - 结算功能

#### 1.3 用户认证
- **登录页面** (`/login`)
  - 用户登录表单
  - 密码验证
  - 登录状态管理

- **注册页面** (`/register`)
  - 用户注册表单
  - 邮箱/手机号验证
  - 密码强度检查

#### 1.4 抽奖活动
- **抽奖页面** (`/lottery`)
  - 新用户欢迎抽奖
  - 抽奖动画效果
  - 奖品展示
  - 中奖记录

### 2. 管理员后台功能

#### 2.1 仪表板
- **管理后台首页** (`/admin`)
  - 核心数据统计（用户数、商品数、订单数、收入）
  - 数据变化趋势
  - 最近订单列表
  - 热销商品排行

#### 2.2 商品管理
- **商品列表** (`/admin/products`)
  - 商品搜索和筛选
  - 批量操作
  - 商品状态管理
  - 库存监控
  - 销量统计

#### 2.3 订单管理
- **订单列表** (`/admin/orders`)
  - 订单搜索（订单号、客户信息）
  - 订单状态筛选
  - 支付状态筛选
  - 订单详情查看
  - 订单状态更新
  - 分页显示

#### 2.4 用户管理
- **用户列表** (`/admin/users`)
  - 用户信息管理
  - 用户状态控制
  - 权限管理

#### 2.5 优惠券管理
- **优惠券列表** (`/admin/coupons`)
  - 优惠券创建和编辑
  - 优惠券状态管理
  - 使用统计

#### 2.6 抽奖管理
- **抽奖活动** (`/admin/lottery`)
  - 抽奖活动创建
  - 奖品配置
  - 中奖概率设置
  - 参与记录查看

#### 2.7 数据分析
- **分析报表** (`/admin/analytics`)
  - 销售数据分析
  - 用户行为分析
  - 商品性能分析

### 3. API接口系统

#### 3.1 认证相关API
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/logout` - 用户登出
- `GET /api/auth/me` - 获取当前用户信息

#### 3.2 商品相关API
- `GET /api/products` - 获取商品列表（支持搜索、筛选、分页）
- `POST /api/products` - 创建商品（管理员）
- `GET /api/products/[id]` - 获取商品详情
- `PUT /api/products/[id]` - 更新商品（管理员）
- `DELETE /api/products/[id]` - 删除商品（管理员）

#### 3.3 用户相关API
- `GET /api/users` - 获取用户列表（管理员）
- `GET /api/users/[id]` - 获取用户详情
- `PUT /api/users/[id]` - 更新用户信息
- `DELETE /api/users/[id]` - 删除用户（管理员）

#### 3.4 订单相关API
- `GET /api/orders` - 获取订单列表
- `POST /api/orders` - 创建订单
- `GET /api/orders/[id]` - 获取订单详情
- `PUT /api/orders/[id]` - 更新订单状态

#### 3.5 优惠券相关API
- `GET /api/coupons` - 获取优惠券列表
- `POST /api/coupons` - 创建优惠券（管理员）
- `GET /api/coupons/[id]` - 获取优惠券详情
- `PUT /api/coupons/[id]` - 更新优惠券
- `DELETE /api/coupons/[id]` - 删除优惠券
- `POST /api/coupons/claim` - 领取优惠券
- `PUT /api/coupons/claim` - 批量发放优惠券（管理员）
- `GET /api/coupons/validate` - 验证优惠券可用性
- `POST /api/coupons/validate` - 使用优惠券
- `GET /api/coupons/usage` - 获取优惠券使用统计

#### 3.6 抽奖相关API
- `GET /api/lottery` - 获取抽奖活动列表
- `POST /api/lottery` - 创建抽奖活动（管理员）
- `GET /api/lottery/[id]` - 获取抽奖活动详情
- `PUT /api/lottery/[id]` - 更新抽奖活动
- `DELETE /api/lottery/[id]` - 删除抽奖活动
- `POST /api/lottery/draw` - 参与抽奖
- `GET /api/lottery/prizes` - 获取奖品列表
- `POST /api/lottery/prizes` - 创建奖品
- `GET /api/lottery/prizes/[id]` - 获取奖品详情
- `PUT /api/lottery/prizes/[id]` - 更新奖品
- `DELETE /api/lottery/prizes/[id]` - 删除奖品

#### 3.7 支付相关API
- `GET /api/payments` - 获取支付记录
- `POST /api/payments` - 创建支付订单
- `POST /api/payments/webhook` - 支付回调处理
- `POST /api/payments/refund` - 申请退款
- `GET /api/payments/config` - 获取支付配置（管理员）
- `PUT /api/payments/config` - 更新支付配置（管理员）
- `POST /api/payments/config/test` - 测试支付配置（管理员）

#### 3.8 数据分析API
- `GET /api/analytics` - 获取分析数据
- `GET /api/analytics/sales` - 销售数据分析
- `GET /api/analytics/users` - 用户数据分析
- `GET /api/analytics/products` - 商品数据分析

### 4. 支付系统

#### 4.1 支持的支付方式
- **支付宝支付**
  - 配置管理（AppId、私钥、公钥等）
  - 支付接口集成
  - 回调处理
  - 退款功能

- **微信支付**
  - 配置管理（AppId、商户号、API密钥等）
  - 支付接口集成
  - 回调处理
  - 退款功能

- **Stripe支付**
  - 配置管理（公钥、私钥、Webhook密钥）
  - 国际支付支持
  - 回调处理
  - 退款功能

#### 4.2 支付功能
- 支付配置管理
- 支付方式测试
- 支付订单创建
- 支付状态跟踪
- 退款处理
- 支付回调验证

### 5. 权限控制系统

#### 5.1 路由保护
- 中间件实现路由权限控制
- 用户登录状态验证
- 管理员权限验证
- 自动重定向到登录页

#### 5.2 API权限控制
- JWT Token验证
- 角色权限检查
- 接口访问控制
- 错误处理

### 6. 优惠券系统

#### 6.1 优惠券类型
- **折扣券**: 按百分比折扣
- **满减券**: 满足金额条件减免
- **免邮券**: 免运费
- **免单券**: 免费订单

#### 6.2 优惠券功能
- 优惠券创建和管理
- 用户领取机制
- 使用条件验证
- 自动计算优惠
- 使用统计分析
- 批量发放功能

### 7. 抽奖系统

#### 7.1 抽奖机制
- 概率控制算法
- 奖品库存管理
- 防重复抽奖
- 中奖记录追踪

#### 7.2 奖品类型
- 优惠券奖品
- 实物商品
- 积分奖励
- 谢谢参与

## 运行逻辑

### 1. 用户购物流程
1. 用户浏览商品列表
2. 查看商品详情
3. 添加商品到购物车
4. 在购物车中调整商品数量
5. 选择商品进行结算
6. 填写收货地址
7. 选择支付方式
8. 完成支付
9. 等待发货
10. 确认收货

### 2. 管理员管理流程
1. 登录管理后台
2. 查看数据统计
3. 管理商品信息
4. 处理订单状态
5. 配置优惠券活动
6. 设置抽奖活动
7. 分析业务数据

### 3. 支付处理流程
1. 用户选择支付方式
2. 系统创建支付订单
3. 调用第三方支付接口
4. 用户完成支付
5. 接收支付回调
6. 验证支付结果
7. 更新订单状态
8. 发送确认通知

### 4. 优惠券使用流程
1. 用户领取或获得优惠券
2. 在结算时选择可用优惠券
3. 系统验证优惠券有效性
4. 计算优惠金额
5. 应用优惠到订单
6. 标记优惠券为已使用

### 5. 抽奖参与流程
1. 用户进入抽奖页面
2. 检查参与资格
3. 点击抽奖按钮
4. 系统随机计算结果
5. 展示抽奖结果
6. 发放奖品到用户账户
7. 记录抽奖日志

## 项目特色

1. **现代化技术栈**: 使用最新的 Next.js 15 和 React 19
2. **完整的电商功能**: 涵盖商品、订单、支付、营销等核心模块
3. **灵活的权限系统**: 支持多角色权限管理
4. **丰富的营销工具**: 优惠券系统和抽奖活动
5. **多支付方式支持**: 集成主流支付平台
6. **响应式设计**: 适配各种设备屏幕
7. **类型安全**: 全面使用 TypeScript
8. **数据库设计**: 完善的关系型数据库设计

## 开发状态

- ✅ 数据库模型设计完成
- ✅ 基础API接口实现
- ✅ 前端页面框架搭建
- ✅ 用户认证系统
- ✅ 商品管理功能
- ✅ 订单管理功能
- ✅ 优惠券系统
- ✅ 抽奖系统
- ✅ 支付系统集成
- ✅ 管理后台界面
- 🔄 功能测试和优化中

## 部署说明

项目使用以下脚本进行开发和部署：
- `npm run dev`: 启动开发服务器
- `npm run build`: 构建生产版本
- `npm run start`: 启动生产服务器
- `npm run lint`: 代码规范检查

数据库使用 Prisma 进行管理：
- `npx prisma generate`: 生成客户端代码
- `npx prisma db push`: 同步数据库结构
- `npx prisma studio`: 启动数据库管理界面